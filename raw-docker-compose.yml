version: '2'
services:
  db:
    image: mongo
    ports:
      - 27017:27017
    # environment:
    #   MONGO_INITDB_ROOT_USERNAME: ${MONGO_USER}
    #   MONGO_INITDB_ROOT_PASSWORD: ${MONGO_PWD}
  sidekick:
    build: .
    restart: on-failure
    ports:
      - 27017:27017
      - 51820:51820
      - 5000:5000
    cap_add:
      - net_admin
      - sys_module
    network_mode: 'host'
    depends_on:
      - db
    environment:
      NODE_ENV: 'production'
      VPN_NET_INTERFACE: ${VPN_NET_INTERFACE}
      VPN_NAME: ${VPN_NAME}
      VPN_PORT: ${VPN_PORT}
      VPN_IP: ${VPN_IP}
      VPN_IP_6: ${VPN_IP_6}
      PUBLIC_IP: ${PUBLIC_IP}
      MONGO_URI: 'mongodb://${MONGO_USER}:${MONGO_PWD}@localhost:27017/sidekickvpn'
